---
title: "[Swift] [Combine] @Published ãªå¤‰æ•°ãŒ Calss ã¨ Struct ã§ã¯æŒ™å‹•ãŒç•°ãªã‚‹ä»¶"
emoji: "ğŸŒ¾"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Swift"]
published: true
---

# çµè«–

`@Published` ãªå¤‰æ•°ã€ã¾ãŸã¯ã€ `CurrentValueSubject` ã® `Output` ã«ã€`Struct` ã¾ãŸã¯ `Calss` ã‚’è¨­å®šã—ãŸå ´åˆã«ä»¥ä¸‹ã®ã‚ˆã†ãªå·®ãŒç”Ÿã˜ã‚‹ã€‚

- `Struct` ã®å ´åˆ
  - å€¤ã‚’æ›´æ–°ã—ãŸå ´åˆã€**å‡ºåŠ›ãŒèµ°ã‚‹**
- `Class` ã®å ´åˆ
  - å€¤ã‚’ã‚’æ›´æ–°ã—ãŸå ´åˆã€**å‡ºåŠ›ã¯èµ°ã‚‰ãªã„**

# Struct ã®å ´åˆ

```swift
// ğŸŒŸstructğŸŒŸ
struct Hoge {
    var mogemoge: Int
    
    init(mogemoge: Int) {
        self.mogemoge = mogemoge
    }
}

let hogePub: CurrentValueSubject<Hoge, Never> = .init(Hoge(mogemoge: 0))

hogePub
    .dropFirst()
    .sink { print("receive: \(String(describing: $0.mogemoge))") }
    .store(in: &cancellables)

hogePub.value = Hoge(mogemoge: 1)
hogePub.value.mogemoge = 2 // â† æ³¨ç›®ğŸŒŸ
hogePub.value = Hoge(mogemoge: 3)

// ï¼ˆå‡ºåŠ›ï¼‰
// receive: 1
// receive: 2 â† æ³¨ç›®ğŸŒŸ
// receive: 3
```

- `var` ã¨ãªã‚‹å¤‰æ•°ã‚’æ›´æ–°ã—ãŸå ´åˆã€**å‡ºåŠ›ãŒèµ°ã‚‹**

ã¡ãªã¿ã« `nil` ã‚’è¨±å®¹ã—ã¦ã„ã‚‹å ´åˆã¯ã€`.value` è‡ªä½“ãŒ `nil` ã§ã‚‚ã€å‡ºåŠ›ãŒãªãŒã‚Œã‚‹ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

- [[Swift] [Combine] CurrentValueSubject ã§ Struct å‹ã‹ã¤ nil ã‚’è¨±å®¹ã—ãŸã¨ãã®æ³¨æ„ç‚¹](https://zenn.dev/ikuraikura/articles/2022-02-26-cvs)

# Class ã®å ´åˆ

```swift
// ğŸŒŸclassğŸŒŸ
class Hoge {
    var mogemoge: Int
    
    init(mogemoge: Int) {
        self.mogemoge = mogemoge
    }
}

let hogePub: CurrentValueSubject<Hoge, Never> = .init(Hoge(mogemoge: 0))

hogePub
    .dropFirst()
    .sink { print("receive: \(String(describing: $0.mogemoge))") }
    .store(in: &cancellables)

hogePub.value = Hoge(mogemoge: 1)
hogePub.value.mogemoge = 2 // â† æ³¨ç›®ğŸŒŸ
hogePub.value = Hoge(mogemoge: 3)

// ï¼ˆå‡ºåŠ›ï¼‰
// receive: 1
// receive: 3
â†‘
receive: 2 ãŒãªã„ï¼ï¼
```

- `var` ã¨ãªã‚‹å¤‰æ•°ã‚’æ›´æ–°ã—ãŸå ´åˆã€**å‡ºåŠ›ã¯èµ°ã‚‰ãªã„**

# å…±é€šã‚³ãƒ¼ãƒ‰

```swift
import Combine

var cancellables = Set<AnyCancellable>()

struct Moge {
    var mogemoge: Int = 0
    
    init(mogemoge: Int) {
        self.mogemoge = mogemoge
    }
}

class Fuga {
    var fugafuga: Int = 0
    
    init(fugafuga: Int) {
        self.fugafuga = fugafuga
    }
}
```

# `@Published` ã®å ´åˆ

```Swift
class Hoge {
    @Published var moge: Moge = .init(mogemoge: 0)
    @Published var fuga: Fuga = .init(fugafuga: 0)
    
    init() {}
}

let hoge: Hoge = .init()
```

## `Struct` ã®å ´åˆ

```Swift
hoge.$moge
    .dropFirst()
    .sink { print("mogemoge: \($0.mogemoge)") }
    .store(in: &cancellables)

hoge.moge = Moge(mogemoge: 1)
hoge.moge.mogemoge = 2 // â† æ³¨ç›®ğŸŒŸ
hoge.moge = Moge(mogemoge: 3)

// ï¼ˆå‡ºåŠ›ï¼‰
// mogemoge: 1
// mogemoge: 2 â† æ³¨ç›®ğŸŒŸ
// mogemoge: 3
```

- `Struct` ã®å ´åˆ
  - å€¤ã‚’æ›´æ–°ã—ãŸå ´åˆã€**å‡ºåŠ›ãŒèµ°ã‚‹**


## `Class` ã®å ´åˆ

```Swift
hoge.$fuga
    .dropFirst()
    .sink { print("fugafuga: \($0.fugafuga)") }
    .store(in: &cancellables)

hoge.fuga = Fuga(fugafuga: 4)
hoge.fuga.fugafuga = 5 // â† æ³¨ç›®ğŸŒŸ
hoge.fuga = Fuga(fugafuga: 6)

// ï¼ˆå‡ºåŠ›ï¼‰
// fugafuga: 4
// fugafuga: 6
â†‘
receive: 5 ãŒãªã„ï¼ï¼
```

- `Class` ã®å ´åˆ
  - å€¤ã‚’ã‚’æ›´æ–°ã—ãŸå ´åˆã€**å‡ºåŠ›ã¯èµ°ã‚‰ãªã„**


# `CurrentValueSubject` ã®å ´åˆ

```Swift
class Hoge {
    var mogePub: CurrentValueSubject<Moge, Never> = .init(.init(mogemoge: 0))
    var fugaPub: CurrentValueSubject<Fuga, Never> = .init(.init(fugafuga: 0))
    
    init() {}
}

let hoge: Hoge = .init()
```

## `Struct` ã®å ´åˆ

```Swift
hoge.mogePub
    .dropFirst()
    .sink { print("mogemoge: \($0.mogemoge)") }
    .store(in: &cancellables)

hoge.mogePub.value = Moge(mogemoge: 1)
hoge.mogePub.value.mogemoge = 2 // â† æ³¨ç›®ğŸŒŸ
hoge.mogePub.value = Moge(mogemoge: 3)

// ï¼ˆå‡ºåŠ›ï¼‰
// mogemoge: 1
// mogemoge: 2 â† æ³¨ç›®ğŸŒŸ
// mogemoge: 3
```

- `Struct` ã®å ´åˆ
  - å€¤ã‚’æ›´æ–°ã—ãŸå ´åˆã€**å‡ºåŠ›ãŒèµ°ã‚‹**

## `Class` ã®å ´åˆ

```Swift
hoge.fugaPub
    .dropFirst()
    .sink { print("fugafuga: \($0.fugafuga)") }
    .store(in: &cancellables)

hoge.fugaPub.value = Fuga(fugafuga: 4)
hoge.fugaPub.value.fugafuga = 5 // â† æ³¨ç›®ğŸŒŸ
hoge.fugaPub.value = Fuga(fugafuga: 6)

// ï¼ˆå‡ºåŠ›ï¼‰
// fugafuga: 4
// fugafuga: 6
â†‘
receive: 5 ãŒãªã„ï¼ï¼
```

- `Class` ã®å ´åˆ
  - å€¤ã‚’ã‚’æ›´æ–°ã—ãŸå ´åˆã€**å‡ºåŠ›ã¯èµ°ã‚‰ãªã„**


# è€ƒå¯Ÿ

ã“ã®ã‚ˆã†ãªæŒ™å‹•ã®å·®ã¯ã€`Class` ãŒå‚ç…§å‹ã§ã‚ã‚Šã€`Struct` ãŒå€¤å‹ã§ã‚ã‚‹ã“ã¨åŸå› ã§ã‚ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

ã¾ãŸã€ä¼¼ãŸã‚ˆã†ãªè©±ã¨ã—ã¦ã€`didSet` ã®æŒ™å‹•ã‚‚ `Class` ã¨ `Struct` ã§å·®ãŒã‚ã‚Šã¾ã™ã€‚

- å‚è€ƒ
  - [å€¤å‹ã¨å‚ç…§å‹ - Swiftã®å§‹ã‚æ–¹](https://swift.codelly.dev/guide/%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%A8%E3%82%AF%E3%83%A9%E3%82%B9/%E5%80%A4%E5%9E%8B%E3%81%A8%E5%8F%82%E7%85%A7%E5%9E%8B.html)
  - [[Swift] Calss ã¨ Struct ã®å¤‰æ•°ã® didSet æŒ™å‹•ã®é•ã„ã«ã¤ã„ã¦](https://zenn.dev/ikuraikura/articles/2022-02-27-did-set)

# ã¾ã¨ã‚

`@Published` ãªå¤‰æ•°ã€ã¾ãŸã¯ã€ `CurrentValueSubject` ã® `Output` ã«ã€`Struct` ã¾ãŸã¯ `Calss` ã‚’è¨­å®šã—ãŸå ´åˆã«ä»¥ä¸‹ã®ã‚ˆã†ãªå·®ãŒç”Ÿã˜ã‚‹ã€‚

- `Struct` ã®å ´åˆ
  - å€¤ã‚’æ›´æ–°ã—ãŸå ´åˆã€**å‡ºåŠ›ãŒèµ°ã‚‹**
- `Class` ã®å ´åˆ
  - å€¤ã‚’ã‚’æ›´æ–°ã—ãŸå ´åˆã€**å‡ºåŠ›ã¯èµ°ã‚‰ãªã„**

ä»¥ä¸Šã«ãªã‚Šã¾ã™ã€‚