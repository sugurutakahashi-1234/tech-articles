---
title: "ã€AWSã€‘ã€Serverless Framework å…¥é–€ã€‘ Serverless Framework ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã®ã¾ã¾ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ãŸ"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["AWS","ServerlessFramework"]
published: true
---
# ã¯ã˜ã‚ã«
ã‚¿ã‚¤ãƒˆãƒ«ã®é€šã‚Šã§ã™ã€‚
Serverless Framework ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ™‚ã®æŒ™å‹•ã‚’ç¢ºèªã™ã‚‹ã ã‘ã«ãªã‚Šã¾ã™ã€‚

ã“ã¡ã‚‰ã®è¨˜äº‹ãŒã¨ã¦ã‚‚å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚
ãƒ»[AWS Lambdaå…¥é–€â‘ (Nodeç·¨)ã€œé–¢æ•°ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å‹•ã‹ã™ã€œ](https://qiita.com/ozaki25/items/883aec0ab4398aa4abbe)

# å‹•ä½œç’°å¢ƒ

```
$ sls --version
Framework Core: 2.11.0
Plugin: 4.1.2
SDK: 2.3.2
Components: 3.3.0
```

å‰æã¨ã—ã¦ã€Serverless Framework ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã€ `aws configure` ã‚‚è¨­å®šæ¸ˆã¿ã«ãªã‚Šã¾ã™ã€‚ï¼ˆ`aws configure list` ã§ç¢ºèªã§ãã¾ã™ã€‚ï¼‰

# å…¨ä½“æ§‹æˆ

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ã¯ä»¥ä¸‹ã®ç’°å¢ƒãŒä½œæˆã§ãã¾ã™ã€‚

![p3ng.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/be08bd1b-2e3b-4b05-4049-956785fe9be7.png)

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆï¼ˆ`sls create -t <ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå> -p <ä½œæˆã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå>`ï¼‰ã—ã¦ã¿ã¾ã™ã€‚

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯[å…¬å¼ã‚µã‚¤ãƒˆ](https://www.serverless.com/framework/docs/providers/aws/cli-reference/create#available-templates)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã„ã‚ã„ã‚ã‚ã‚Šã¾ã™ã€‚

```
# aws-nodejs ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å…ƒã« hogehoge ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
$ sls create -t aws-nodejs -p hogehoge
Serverless: Generating boilerplate...
Serverless: Generating boilerplate in "/Users/sugurutakahashi/git/hogehoge"
 _______                             __
|   _   .-----.----.--.--.-----.----|  .-----.-----.-----.
|   |___|  -__|   _|  |  |  -__|   _|  |  -__|__ --|__ --|
|____   |_____|__|  \___/|_____|__| |__|_____|_____|_____|
|   |   |             The Serverless Application Framework
|       |                           serverless.com, v2.9.0
 -------'

Serverless: Successfully generated boilerplate for template: "aws-nodejs"
```

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

```
$ cd hogehoge 
$ tree -a
.
â”œâ”€â”€ .gitignore
â”œâ”€â”€ handler.js
â””â”€â”€ serverless.yml
```

# ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

ä½œæˆã•ã‚ŒãŸãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`.gitignore`ã€`handler.js`ã€`serverless.yml`ï¼‰ã®3ã¤ã®ä¸­èº«ã‚’ã¿ã¦ã¿ã¾ã™ã€‚

```text:.gitignore
# package directories
node_modules
jspm_packages

# Serverless directories
.serverless
```

```javascript:handler.js
'use strict'

module.exports.hello = async event => {
  return {
    statusCode: 200,
    body: JSON.stringify(
      {
        message: 'Go Serverless v1.0! Your function executed successfully!',
        input: event,
      },
      null,
      2
    ),
  };

  // Use this code if you don't use the http event with the LAMBDA-PROXY integration
  // return { message: 'Go Serverless v1.0! Your function executed successfully!', event };
};
```

```yaml:serverless.yml
service: hogehoge
frameworkVersion: '2'

provider:
  name: aws
  runtime: nodejs12.x

functions:
  hello:
    handler: handler.hello
```
â€» serverless.yml ã¯ã‚³ãƒ¡ãƒ³ãƒˆéƒ¨åˆ†ã‚’çœç•¥ã—ã¦ã„ã¾ã™ã€‚

# é–¢æ•°ã®å®Ÿè¡Œ

åˆæœŸå€¤ã§ `hello` ã¨ã„ã†é–¢æ•°ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªã®ã§å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

## ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®é–¢æ•°ã®å®Ÿè¡Œï¼ˆå¼•æ•°ãªã—ï¼‰

é–¢æ•°ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ï¼ˆ`sls invoke local --function <é–¢æ•°å>`ï¼‰ã§ã™ã€‚

```
$ sls invoke local --function hello
{
    "statusCode": 200,
    "body": "{\n  \"message\": \"Go Serverless v1.0! Your function executed successfully!\",\n  \"input\": \"\"\n}"
}
```
ã¨ã‚Šã‚ãˆãšå®Ÿè¡Œã•ã‚ŒãŸã¿ãŸã„ã§ã™ã€‚

## ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®é–¢æ•°ã®å®Ÿè¡Œï¼ˆå¼•æ•°ã‚ã‚Šï¼‰

`handler.js` ã‚’ã‚ˆãã¿ã‚‹ã¨ `hello` é–¢æ•°ã®å¼•æ•° `event` ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® `body` ã® `input` ã® value ã«ãªã‚‹ã¿ãŸã„ãªã®ã§ã€å¼•æ•°ã‚’æ¸¡ã—ã¦ã‚ã’ã¾ã™ã€‚

`sls invoke local --function <é–¢æ•°å> --data <å¼•æ•°>` ã§å¼•æ•°ã‚’æ¸¡ã—ãªãŒã‚‰é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```
$ sls invoke local --function hello --data test
{
    "statusCode": 200,
    "body": "{\n  \"message\": \"Go Serverless v1.0! Your function executed successfully!\",\n  \"input\": \"test\"\n}"
}
```
`input` ã® value ãŒå¼•æ•°ã§æ¸¡ã—ãŸ `test` ã«ãªã‚Šã¾ã—ãŸã€‚


# ãƒªãƒ¢ãƒ¼ãƒˆã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

ã¨ã‚Šã‚ãˆãšãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ`sls deploy -v`ï¼‰ã—ã¦ã¿ã¾ã™ã€‚
`-v` ã¯ `--verbose` ã®ç•¥ã§è©³ç´°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚

```
$ sls deploy -v
ï¼ˆçœç•¥ï¼‰
Serverless: Stack update finished...
Service Information
service: hogehoge
stage: dev
region: us-east-1
stack: hogehoge-dev
resources: 6
api keys:
  None
endpoints:
  None
functions:
  hello: hogehoge-dev-hello
layers:
  None

Stack Outputs
HelloLambdaFunctionQualifiedArn: arn:aws:lambda:us-east-1:653595591267:function:hogehoge-dev-hello:3
ServerlessDeploymentBucketName: hogehoge-dev-serverlessdeploymentbucket-1q2qo8ezm7dcf
```

ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã« `.serverless` ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œã‚‰ã‚Œã¦ã„ã¾ã—ãŸã€‚

```
$ tree -a
.
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .serverless
â”‚   â”œâ”€â”€ cloudformation-template-create-stack.json
â”‚   â”œâ”€â”€ cloudformation-template-update-stack.json
â”‚   â”œâ”€â”€ hogehoge.zip
â”‚   â””â”€â”€ serverless-state.json
â”œâ”€â”€ handler.js
â””â”€â”€ serverless.yml
```

ã¡ãªã¿ã« `.serverless/hogehoge.zip` ã‚’è§£å‡ã—ãŸã¨ã“ã‚ã€`handler.js` ãŒå…¥ã£ã¦ã„ã¾ã—ãŸã€‚

`serverless.yml` ã¨ `handler.js` ã‚’è§£é‡ˆã—ã¦ã€`.serverless` ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã¦ã€æœ¬è³ªçš„ã«ã¯ã“ã¡ã‚‰ã®ãƒ•ã‚©ãƒ«ãƒ€ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹æ„Ÿã˜ãªã®ã§ã—ã‚‡ã†ã­ã€‚

# ãƒªãƒ¢ãƒ¼ãƒˆã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸé–¢æ•°ã®å®Ÿè¡Œ

ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸ hello é–¢æ•°ã‚’å®Ÿè¡Œï¼ˆ`sls invoke --function <é–¢æ•°å> --data <å¼•æ•°> --region <ãƒªãƒ¼ã‚¸ãƒ§ãƒ³>`ï¼‰ã—ã¦ã¿ã¾ã™ã€‚

ä»Šå›ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¯ `sls deploy -v` ã®çµæœã‚’ã¿ã‚‹ã¨ `us-east-1` ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€`us-east-1` ã‚’æŒ‡å®šã—ã¾ã™ã€‚

ã¡ãªã¿ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¯ `us-east-1` ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‹ã‚‰å¤‰æ›´ã™ã‚‹å ´åˆã¯ `serverless.yml` ã§è¨­å®šã—ã¾ã™ã€‚ä¾‹ãˆã°ã€æ±äº¬ã§ã‚ã‚Œã° `ap-northeast-1` ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚

```
$ sls invoke --function hello --data hogeeee --region us-east-1
{
    "statusCode": 200,
    "body": "{\n  \"message\": \"Go Serverless v1.0! Your function executed successfully!\",\n  \"input\": \"hogeeee\"\n}"
}
```

# AWS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ç¢ºèª

AWS ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’è¦—ã„ã¦ã¿ã¾ã™ã€‚
ãƒªãƒ¢ãƒ¼ãƒˆç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

`us-east-1` ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã£ã¦ã„ã‚‹ã®ã§ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¯ãƒãƒ¼ã‚¸ãƒ‹ã‚¢åŒ—éƒ¨ã‚’é¸æŠã—ã¾ã™ã€‚

## CloudFormation

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-11-09 19.46.21.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/e49ee923-a3f6-e4b9-ea4a-9c9d9da00b8b.png)

CloudFormationã« hogehoge ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¹ã‚¿ãƒƒã‚¯ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ dev ã¨ã„ã†ã‚¹ãƒ†ãƒ¼ã‚¸åã«ãªã£ã¦ã„ã‚‹ã®ã§ãã‚ŒãŒåæ˜ ã•ã‚ŒãŸå½¢ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã‚¹ãƒ†ãƒ¼ã‚¸åã¯è‡ªç”±ã«è¨­å®šã§ãã‚‹ã‚‚ã®ã§ `serverless.yml` ã§è¨­å®šã§ãã¾ã™ã€‚

CloudFormationã‚„ã‚¹ã‚¿ãƒƒã‚¯ã«ã¤ã„ã¦ã¯[ã“ã¡ã‚‰](https://dev.classmethod.jp/articles/cloudformation-beginner01/)ã®è¨˜äº‹ãŒã‚ã‹ã‚Šã‚„ã™ã„ã‹ã¨æ€ã„ã¾ã™ã€‚

ã‚¹ã‚¿ãƒƒã‚¯ã¯ä¸€è¨€ã§è¨€ã†ã¨ã²ã¨ã¤ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‹ãŸã¾ã‚Šã¿ãŸã„ãªã‚‚ã®ã§ã™ã€‚

## Lambda

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-11-09 19.47.44.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/fe66ed01-a72b-636a-d9b6-c3a59fbcd8fa.png)

Lambda ã« hogehoge ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® dev ã‚¹ãƒ†ãƒ¼ã‚¸ã® hello é–¢æ•°ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚

## CloudWatch Logs

ãƒªãƒ¢ãƒ¼ãƒˆã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸé–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ï¼ˆ`sls invoke --function <é–¢æ•°å> --data <å¼•æ•°> --region <ãƒªãƒ¼ã‚¸ãƒ§ãƒ³>`ï¼‰ã¨ CloudWatch Logs ã«åæ˜ ã•ã‚Œã¾ã™ã€‚

CloudWatch > CloudWatch Logs > Log groups > /aws/lambda/hogehoge-dev-hello ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-11-09 20.31.57.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/4a3af470-9905-7c12-c5af-c3c2b4f9ca83.png)


# ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤

æœ€å¾Œã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ï¼ˆ`sls remove -v`ï¼‰ã—ã¾ã™ã€‚
ãã®ã¾ã¾æ”¾ã£ã¦ãŠã„ã¦ã€ã‚ã¨ã§ãŠé‡‘ã‚’è«‹æ±‚ã•ã‚Œã‚‹ã®ã¯å›°ã‚‹ã®ã§ã€è¨˜æ†¶ãŒã‚ã‚‹ã†ã¡ã«æ¶ˆã—ã¾ã™ã€‚

```
$ sls remove -v
```

AWS ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã® CloudFormation ã¨ Lambda ã‚’è¦‹ã«è¡Œãã¨ãƒªã‚½ãƒ¼ã‚¹ãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

# ãŠã‚ã‚Šã«
ä»¥ä¸Šã«ãªã‚Šã¾ã™ã€‚

ç¶šç·¨
ãƒ»[ã€Serverless Framework å…¥é–€ã€‘ API Gateway + Lambda + DynamoDB ã‚µãƒ³ãƒ—ãƒ«](https://qiita.com/sugurutakahashi12345/items/8eafa9ef6ce26531290a)
