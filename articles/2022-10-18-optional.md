---
title: "[Swift] nil ã®æ„å‘³ã‚’æ˜ç¢ºã«ã™ã‚‹æ–¹æ³•"
emoji: "ğŸ•Š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Swift"]
published: true
---


# ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³

`nil` ã‚’ä¹±æš´ã«å¤šç”¨ã—ã¦ã„ã‚‹ã¨ `nil` ãŒè¡¨ã™æ„å‘³ãŒè¤‡æ•°ã«è†¨ã‚Œä¸ŠãŒã£ã¦ã—ã¾ã†ãŸã‚ã€ä½•ã®ãŸã‚ã« `nil` ã«ã—ã¦ã„ã‚‹ã‹ã‚’å¤‰æ•°ã‹ã‚‰å¯Ÿã™ã‚‹ã“ã¨ãŒã§ããªã„ã‹ã¨è€ƒãˆã¾ã—ãŸã€‚

# `nil` ã®æ„å‘³ã‚’æ˜ç¢ºã«ã™ã‚‹æ–¹æ³•

ä»¥ä¸‹ã®ã‚ˆã†ã« `Optional` ã‚’æ‹¡å¼µã™ã‚‹ã¨ã€å¤‰æ•°åã‹ã‚‰ `nil` ã®æ„å‘³ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```swift
extension Optional {
    static var nilForDefault: Wrapped? {
        nil
    }

    static var nilForError: Wrapped? {
        nil
    }
}

// ä½¿ã„æ–¹
var num: Int? = .nilForDefault
var str: String? = .nilForError
```

# ä½¿ã„æ–¹ï¼ˆå¿œç”¨ï¼‰

`where Wrapped == å‹å` ã§å‹ã‚’çµã‚Šè¾¼ã‚“ã§ã€`nil` ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```swift
extension Optional where Wrapped == Int {
    static var nilForXXXXX: Wrapped? {
        nil
    }
}

var num: Int? = .nilForDefault // nil
var str: String? = .nilForXXXXX // Type 'String' has no member 'nilForXXXXX'
```

# ãã‚‚ãã‚‚

`nilForError` ãªã©ã‚’ä½¿ã†ã“ã¨ã¯é–“é•ã£ã¦ã„ã¦ã€Error ã‚’ throw ã™ã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ãªã„è¨¼æ‹ ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

## è£œè¶³ï¼ˆãƒ€ãƒ¡ãªä¾‹ï¼‰

### ãƒ€ãƒ¡ãªä¾‹ ãã®1

ä»¥ä¸‹ã§ã¯ã†ã¾ãã„ãã¾ã›ã‚“ã€‚

```swift
enum Nil {
    static let forDefault: Optional<Any> = nil
}

var num: Int? = Nil.forDefault as! Int // expression failed to parse: error: op.playground:3:5: error: consecutive statements on a line must be separated by ';'
```

ãã‚‚ãã‚‚ `Nil.forDefault` ã¯ `Optional<Any>` å‹ã§ã‚ã‚Šã€`Optional<Int>` ã§ã¯ãªã„ã®ã§ã€`as!` or `as?` ã§å‹ã‚’åˆ¤å®šã—ãªã‘ã‚Œã°ãªã‚‰ãªãã€ã†ã¾ãã„ãã¾ã›ã‚“ã€‚

### ãƒ€ãƒ¡ãªä¾‹ ãã®2

`Optional<Any>` ã§ãƒ€ãƒ¡ãªã‚‰ã€å‹ã‚’æŒ‡å®šã™ã‚Œã°ã‚ˆã„ã¨ã„ã†è€ƒãˆæ–¹ã§ã™ã€‚

```swift
struct Nil {
    static let forDefault: Optional<Int> = nil
}

var num: Int? = Nil.forDefault // OK
var str: String? = Nil.forDefault // NG: Cannot convert value of type 'Optional<Int>' to specified type 'String?'
```

`as!` or `as?` ã§ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹å¿…è¦ã¯ãªããªã‚Šã¾ã—ãŸãŒã€ã™ã¹ã¦ã®å‹ã«ãŠã„ã¦ã€ã„ã¡ã„ã¡å®šç¾©ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚

### ãƒ€ãƒ¡ãªä¾‹ ãã®3

```swift
extension Optional {
    var nilForDefault: Wrapped? {
        nil
    }
}

var num: Int? = .nilForDefault // â† ã“ã‚Œã¯ã§ããªã„

// ã“ã‚Œãªã‚‰ã§ãã‚‹ãŒã€ã‚„ã‚ŠãŸã„ã“ã¨ã§ã¯ãªã„
num = 0
num.nilForDefault // nil
```

ä»¥ä¸Šã§ã™ã€‚