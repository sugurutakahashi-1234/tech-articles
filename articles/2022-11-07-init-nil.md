---
title: "[Swift] ã‚¤ãƒ‹ã‚·ãƒ£ãƒ©ã‚¤ã‚ºã§å¤±æ•—ã™ã‚‹å ´åˆã¯ nil ã‚’è¿”ã™ã®ã§ã¯ãªã throw ã—ã‚ˆã†"
emoji: "ğŸ•Š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Swift"]
published: true
---

# ä¼ãˆãŸã„ã“ã¨

- ã‚¤ãƒ‹ã‚·ãƒ£ãƒ©ã‚¤ã‚ºã§å¤±æ•—ã™ã‚‹å ´åˆã¯ `nil` ã‚’è¿”ã™ã®ã§ã¯ãªãã€ã‚¨ãƒ©ãƒ¼ã‚’ `throw` ã—ã‚ˆã†
  - ãƒ¡ãƒªãƒƒãƒˆ
    - `throw` ã—ãŸå…ˆã§ `nil` ã«ã‚‚ã§ãã‚‹ã—ã€ã•ã‚‰ã« `throw` ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹
    - ã‚¨ãƒ©ãƒ¼ã®å†…å®¹ã‚’å‡ºã—åˆ†ã‘ã‚‹ã“ã¨ã‚„ enum ã®é€£æƒ³å€¤ã§æƒ…å ±ã‚’æŒãŸã›ã‚‹ã“ã¨ã‚‚å¯èƒ½
  - ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
    - ç‰¹ã«ãªã—

# (before) `nil` ã‚’è¿”å´ã™ã‚‹å ´åˆ

```swift
struct NilHoge {
    var moge: Int
    var fuga: Int
    
    init?(moge: Int, fuga: Int) {
        guard moge > 0 else {
            return nil
        }
        guard fuga > 0 else {
            return nil
        }
        self.moge = moge
        self.fuga = fuga
    }
}
```

## ã‚¤ãƒ‹ã‚·ãƒ£ãƒ©ã‚¤ã‚ºã«å¤±æ•—ã—ãŸå ´åˆã¯ nil ã‚’ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ã—ã‹ã§ããªã„

```swift
func testFuncNilHoge(moge: Int, fuga: Int) -> NilHoge? {
    guard let nilHoge = NilHoge(moge: moge, fuga: fuga) else {
        print("Initialization failed")
        return nil
    }
    print(nilHoge)
    return nilHoge
}

testFuncNilHoge(moge: 1, fuga: -1) // Initialization failed
```

`nil` ã®æ„å‘³ãŒä¸é€æ˜ã§ã‚ã‚Šã€ä½•ã«ã‚ˆã£ã¦ã‚¤ãƒ‹ã‚·ãƒ£ãƒ©ã‚¤ã‚ºãŒå¤±æ•—ã—ãŸã‹ã®æƒ…å ±ãŒ `nil` ã ã‘ã§ã¯è¡¨ã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚
-> `moge` ã®å€¤ãŒã‚ˆããªã‹ã£ãŸã®ã‹ã€`fuga` ã®å€¤ãŒã‚ˆããªã‹ã£ãŸã®ã‹ãŒã‚ã‹ã‚‰ãªã„

# (after) ã‚¨ãƒ©ãƒ¼ã‚’ `throw` ã™ã‚‹å ´åˆ

```swift
enum HogeInitializeError: Error {
    case mogeError(Int)
    case fugaError(Int)
}

struct ThrowsHoge {
    var moge: Int
    var fuga: Int
    
    init(moge: Int, fuga: Int) throws {
        guard moge > 0 else {
            throw HogeInitializeError.mogeError(moge) // <-
        }
        guard fuga > 0 else {
            throw HogeInitializeError.mogeError(fuga) // <-
        }
        self.moge = moge
        self.fuga = fuga
    }
}
```

ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚ˆã†ã«ã€`throw` ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã‚’å¥½ããªã‚ˆã†ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## (ãƒ‘ã‚¿ãƒ¼ãƒ³1) try? ã—ã¦ guard let ã§ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã™ã‚‹

```swift
func testFuncThrowsHoge1(moge: Int, fuga: Int) -> ThrowsHoge? {
    guard let throwsHoge = try? ThrowsHoge(moge: moge, fuga: fuga) else {
        print("Initialization failed")
        return nil
    }
    print(throwsHoge)
    return throwsHoge
}

testFuncThrowsHoge1(moge: 1, fuga: -1) // Initialization failed
```

## (ãƒ‘ã‚¿ãƒ¼ãƒ³2) do-catch ã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹

```swift
func testFuncThrowsHoge2(moge: Int, fuga: Int) -> ThrowsHoge {
    do {
        let throwsHoge = try ThrowsHoge(moge: moge, fuga: fuga)
        print(throwsHoge)
        return throwsHoge
    } catch {
        fatalError("\(error)")
    }
}

testFuncThrowsHoge2(moge: 1, fuga: -1) // __lldb_expr_222/init thorow.playground:66: Fatal error: mogeError(-1)
```

## (ãƒ‘ã‚¿ãƒ¼ãƒ³3) ã•ã‚‰ã« throws ã™ã‚‹

```swift
func testFuncThrowsHoge3(moge: Int, fuga: Int) throws -> ThrowsHoge {
    let throwsHoge = try ThrowsHoge(moge: moge, fuga: fuga)
    print(throwsHoge)
    return throwsHoge
}

// 3-1. ã•ã‚‰ã« throws ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½
func testFunc() throws {
    try testFuncThrowsHoge3(moge: 1, fuga: -1)
}

// 3-2. do-catch ã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¯èƒ½
do {
    try testFuncThrowsHoge3(moge: 1, fuga: -1)
} catch {
    print("\(error)") // mogeError(-1)
}
```

ä»¥ä¸Šã«ãªã‚Šã¾ã™ã€‚