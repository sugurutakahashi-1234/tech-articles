---
title: "[Swift] [Combine] Publisher ã‚’ flatMap() å†…ã«éš è”½ã—ã¦ç›´æ¥ subscribe ã™ã‚‹ã®ã‚’é¿ã‘ã‚‹æ–¹æ³•"
emoji: "ğŸŒ¾"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Swift"]
published: true
---

# ã¯ã˜ã‚ã«

ä»¥ä¸‹ã®è¨˜äº‹ã«ã‚‚ã‚ã‚‹ã‚ˆã†ã«ã€ã€Failure ã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ Publisher ã‚’ç›´æ¥ subscribe ã—ã¦ã„ã‚‹å ´åˆã€ä¸€åº¦ã§ã‚‚ Failure ãŒç™ºç”Ÿã™ã‚‹ã¨ã€ãã®æ™‚ç‚¹ã§ Completion ã¨ãªã‚Šã€Output ã‚’å—ã‘ä»˜ã‘ãªããªã‚‹ã€ã¨ã„ã†æŒ™å‹•ã‚’ç¤ºã—ã¾ã™ã€‚

- [[Swift] [Combine] ã‚¨ãƒ©ãƒ¼ãŒã‚ã£ã¦ã‚‚æ­¢ã¾ã‚‰ãªã„ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä½œã‚ŠãŸã„ï¼](https://zenn.dev/ikuraikura/articles/2022-02-17-result)

ãã®å›é¿æ–¹æ³•ã¨ã—ã¦ã€è¨˜äº‹å†…ã§ã¯ `flatMap() å†…ã§ã® tryMap() -> catch -> Empty ã®åˆã‚ã›æŠ€` ã‚’ç´¹ä»‹ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€**ãã‚‚ãã‚‚å¤–å´ã«ã‚ã‚‹ Publisher ã‚’ `flatMap()` å†…ã«éš è”½ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã€ã„ãã¤ã‹ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚‹ã®ã§ã€ãã‚Œã‚’ç´¹ä»‹ã™ã‚‹è¨˜äº‹ã«ãªã‚Šã¾ã™ã€‚**

---

ä»¥ä¸‹ã¯å…±é€šã®ã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚

```swift:å‰æ
import Combine
import Foundation

var cancellables: Set<AnyCancellable> = []

let numPublisher = PassthroughSubject<Int, Never>()
```

# æ–¹æ³•1: `Just()` ã‚’ä½¿ã† â† ã‚ªã‚¹ã‚¹ãƒ¡

ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```swift
numPublisher
    .flatMap {
        Just($0)
            .eraseToAnyPublisher()
    }
    .sink { print("\($0)") }
    .store(in: &cancellables)
```

è¨€ã‚ã‚Œã¦ã¿ã‚Œã°ã€ãã‚Œã¯ãã†ãªã®ã§ã™ãŒã€`Just()` ã‚’ä½¿ãˆã°ä¸€ç™ºã§ã™ã­ã€‚

**ã“ã‚ŒãŒä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ«ã ã¨æ€ã„ã¾ã™ã€‚**

# æ–¹æ³•2: `map()` ã«ã‚ˆã‚‹é…åˆ—å¤‰æ› -> `Array.publisher` ã‚’ä½¿ã†

ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```swift
numPublisher
    .map { [$0] }
    .flatMap {
        $0.publisher
    }
    .sink { print("\($0)") }
    .store(in: &cancellables)
```

é…åˆ—ã§ã‚ã‚Œã°ã€`.publisher` ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹ã§ã€Publisher å¤‰æ›ã§ãã‚‹ã®ã§ã€ãã‚Œã‚’åˆ©ç”¨ã—ãŸå½¢ã«ãªã‚Šã¾ã™ã€‚

# æ–¹æ³•3: `collect(1)` ã«ã‚ˆã‚‹é…åˆ—å¤‰æ›  -> `Array.publisher` ã‚’ä½¿ã†

ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```swift
numPublisher
    .collect(1)
    .flatMap {
        $0.publisher
    }
    .sink { print("\($0)") }
    .store(in: &cancellables)
```

`æ–¹æ³•2` ã¨ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯åŒã˜ã§ã™ã€‚

ã¡ã‚‡ã£ã¨ç„äººæ„ŸãŒã‚ã‚Šã¾ã™ã€‚

# çµè«–

- **Publisher ã‚’ `flatMap()` å†…ã«éš è”½ã—ã¦ç›´æ¥ subscribe ã™ã‚‹ã®ã‚’é¿ã‘ã‚‹ãªã‚‰ã€`Just()` ã‚’ä½¿ãŠã†**

ä»¥ä¸Šã«ãªã‚Šã¾ã™ã€‚