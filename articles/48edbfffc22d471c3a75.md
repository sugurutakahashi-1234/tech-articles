---
title: "ã€AWSã€‘ã€Serverless Framework å…¥é–€ã€‘ API Gateway + Lambda + DynamoDB ã‚µãƒ³ãƒ—ãƒ«"
emoji: "ğŸŒ³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["AWS","DynamoDB","lambda","APIGateway","ServerlessFramework"]
published: true
---
# ã¯ã˜ã‚ã«
[ã“ã¡ã‚‰ã®è¨˜äº‹](https://qiita.com/sugurutakahashi12345/items/afd14d2939a4a26fefa4)ã®ç¶šç·¨ã«ãªã‚Šã¾ã™ã€‚

å‰å›ã¯ Serverless Framework ã‚’ä½¿ã£ã¦ hello é–¢æ•°ã‚’ Lambda ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã¨ã“ã‚ã¾ã§è¡Œã„ã¾ã—ãŸã€‚
ï¼ˆLambda ã‚’ãŸã ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚Œã°å‰ç·¨ã®è¨˜äº‹ã¯è¦‹ãªãã¦ã‚‚å…¨ç„¶å¤§ä¸ˆå¤«ã§ã™ã€‚ï¼‰

ä»Šå›ã¯ãã‚Œã‚’ API Gateway çµŒç”±ã§ API ã¨ã—ã¦å…¬é–‹ã—ã€ã•ã‚‰ã« DynamoDB ã¨ã®ç–é€šã«ã‚‚è©¦ã¿ã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã® Serverless Framework ã®[å…¬å¼ã‚µãƒ³ãƒ—ãƒ«]([https://www.serverless.com/examples/])ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

- [AWS | REST API Example](https://www.serverless.com/examples/aws-node-rest-api)
- [AWS | REST API With DynamoDB](https://www.serverless.com/examples/aws-node-rest-api-with-dynamodb)


# ã§ããŸã“ã¨

ä»¥ä¸‹ã®å›³ã®ç’°å¢ƒã‚’ Serverless Framework ã§æ§‹ç¯‰ã—ã¾ã—ãŸã€‚

![png.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/1020501a-4e9a-a717-7596-27c986876e2c.png)

ã‚½ãƒ¼ã‚¹ã¯ [GitHub](https://github.com/suguruTakahashi-1234/sls-hogehoge) ã«å…¬é–‹ã—ãŸã®ã§ãã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
å…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã®[ã€ŒAWS | REST API With DynamoDBã€](https://www.serverless.com/examples/aws-node-rest-api-with-dynamodb) ã¨ã»ã¨ã‚“ã©åŒã˜ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã—ãŸã€‚

ä¸€æ°—ã«è§£èª¬ã™ã‚‹ã¨å¤§å¤‰ãªã®ã§ä»¥ä¸‹ã®æ‰‹é †ã«åˆ†ã‘ã¦è¦‹ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

1. API ã®å…¬é–‹ï¼ˆç·´ç¿’ï¼‰
2. DynamoDB ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
3. API ã®å…¬é–‹ã¨ DynamoDB ã¨ã®ç–é€š

# 1. API ã®å…¬é–‹ï¼ˆç·´ç¿’ï¼‰

ä»¥ä¸‹ã®å…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚
ãƒ»[AWS | REST API Example](https://www.serverless.com/examples/aws-node-rest-api)

hello é–¢æ•°ã‚’ GET ãƒ¡ã‚½ãƒƒãƒ‰ã® API ã¨ã—ã¦å…¬é–‹ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## serverless.yml ã®å¤‰æ›´

`serverless.yml` ã« https ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff:serverless.yml
 functions:
   hello:
     handler: handler.hello
+    events:
+      - http:
+          path: hello
+          method: get
```

## ãƒ‡ãƒ—ãƒ­ã‚¤

å¤‰æ›´å¾Œã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã™ã€‚

```shell
$ sls deploy -v
ï¼ˆçœç•¥ï¼‰
Serverless: Stack update finished...
Service Information
service: hogehoge
stage: dev
region: us-east-1
stack: hogehoge-dev
resources: 11
api keys:
  None
endpoints:
  GET - https://xxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/hello
functions:
  hello: hogehoge-dev-hello
layers:
  None

Stack Outputs
HelloLambdaFunctionQualifiedArn: arn:aws:lambda:us-east-1:xxxxxxxxx:function:hogehoge-dev-hello:5
ServiceEndpoint: https://xxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev
ServerlessDeploymentBucketName: hogehoge-dev-serverlessdeploymentbucket-1q2qo8ezm7dcf
```

https ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ã—ãŸã“ã¨ã«ã‚ˆã£ã¦ã€ã“ã¡ã‚‰ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒé–‹æ”¾ã•ã‚Œã¾ã™ã€‚

```
endpoints:
  GET - https://xxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/hello
```

## API ã®ç–é€šç¢ºèª

curl ã§å©ã„ã¦ã¿ã¾ã™ã€‚

```
$ curl https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/hello
{
  "message": "Go Serverless v1.0! Your function executed successfully!",
  "input": {
    "resource": "/hello",
    ï¼ˆçœç•¥ï¼‰
  }
}
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚API ã®å…¬é–‹ã®æˆåŠŸã§ã™ã€‚

## AWS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ç¢ºèª

AWS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã® API Gateway ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚
![gateway.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/6c59f1bd-f9fc-9c0e-0392-65c1a762f350.png)
ã“ã®ã‚ˆã†ã« API ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
ã¡ãªã¿ã« `serverless.yml` ã« `events.http.path` ã‚’è¨˜è¿°ã—ãªã„ã¨ API Gateway ã«ã¯ä½•ã‚‚ç™»éŒ²ã•ã‚Œã¾ã›ã‚“ã€‚

ä»¥ä¸Šã§ API ã‚’å…¬é–‹ã™ã‚‹æ–¹æ³•ã¯ã‚ã‹ã‚Šã¾ã—ãŸã€‚

# 2. DynamoDB ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

ä»¥ä¸‹ã®å…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚
ãƒ» [AWS | REST API With DynamoDB](https://www.serverless.com/examples/aws-node-rest-api-with-dynamodb)

ã“ã¡ã‚‰ã®ã‚µãƒ³ãƒ—ãƒ«ã® DynamoDB ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã ã‘ã‚’æŠœãå‡ºã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

## serverless.yml ã®å¤‰æ›´

```diff:serverless.yml
 provider:
   name: aws
   runtime: nodejs12.x
+  environment:
+    DYNAMODB_TABLE: ${self:service}-${opt:stage, self:provider.stage}
+  iamRoleStatements:
+    - Effect: Allow
+      Action:
+        - dynamodb:Query
+        - dynamodb:Scan
+        - dynamodb:GetItem
+        - dynamodb:PutItem
+        - dynamodb:UpdateItem
+        - dynamodb:DeleteItem
+      Resource: "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.DYNAMODB_TABLE}"

ï¼ˆçœç•¥ï¼‰

+resources:
+  Resources:
+    TodosDynamoDbTable:
+      Type: 'AWS::DynamoDB::Table'
+#     DeletionPolicy: Retain
+      Properties:
+        AttributeDefinitions:
+          -
+            AttributeName: id
+            AttributeType: S
+        KeySchema:
+          -
+            AttributeName: id
+            KeyType: HASH
+        ProvisionedThroughput:
+          ReadCapacityUnits: 1
+          WriteCapacityUnits: 1
+        TableName: ${self:provider.environment.DYNAMODB_TABLE}
```

`provider` ã¨ `resources` ã«åˆ†ã‘ã¦ç°¡å˜ã«è§£èª¬ã—ã¾ã™ã€‚

### provider

`provider` ã«ã¯å…±é€šã§ç”¨ã„ã‚‹ç’°å¢ƒå¤‰æ•°ã®è¨­å®šã‚„ Lambda ã‹ã‚‰ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã«é–¢ã™ã‚‹ IAM ãƒ­ãƒ¼ãƒ«ãªã©ã‚’è¨­å®šã—ã¾ã™ã€‚

```yaml:serverless.yml
provider:
  name: aws
  runtime: nodejs12.x
  environment:
    DYNAMODB_TABLE: ${self:service}-${opt:stage, self:provider.stage}
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:UpdateItem
        - dynamodb:DeleteItem
      Resource: "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.DYNAMODB_TABLE}"
```

- `opt:xxx`
  - ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ `sls deploy --stage prd` ã¨å®Ÿè¡Œã—ãŸå ´åˆã¯ ${opt:stage} = prd ã¨ãªã‚Šã¾ã™ã€‚
- `self:xxx`
  - ã“ã®è¨˜æ³•ã§è‡ªèº«ã® serverless.yml ã§å®šç¾©ã—ã¦ã„ã‚‹ key ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
- `${opt:xxx, self:xxx}`
  - `opt:xxx` ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚Œã°ãã®å€¤ã‚’å„ªå…ˆã—ã€ã‚‚ã—ã€å®šç¾©ã•ã‚Œã¦ã„ãªã„ã‘ã‚Œã° `self:xxx` ã®å€¤ã‚’ä½¿ç”¨ã™ã‚‹æ›¸ãæ–¹ã§ã™ã€‚
- `environment`
  - ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚ä»Šå›ã¯ã“ã“ã«ãƒ‡ãƒ¼ãƒ–ãƒ«åã‚’å®šç¾©ã—ã¾ã™ã€‚
- `iamRoleStatements`
  - å®Ÿè¡Œæ™‚ã«ä»–ã® AWS ãƒªã‚½ãƒ¼ã‚¹ã‚’å‚ç…§ã™ã‚‹å ´åˆã«ã“ã“ã§ Lambda ã® IAM ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¾ã™ã€‚ä»Šå›ã¯ DynamoDB ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚
- `Resource: "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.DYNAMODB_TABLE}"`
  - è¨­å®šã—ãŸ IAM ãƒ­ãƒ¼ãƒ«ã¯ã“ã“ã®é …ç›®ã§è¨­å®šã—ãŸãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦æœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚DynamoDB ã®ç‰¹å®šã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾ã—ã¦æœ‰åŠ¹ã«ã™ã‚‹å ´åˆã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã¡ãªã¿ã« `${self:provider.environment.DYNAMODB_TABLE}` ã¯ä¸Šè¨˜ã§è§£èª¬ã—ã¦ã„ã‚‹ã‚ˆã†ã« `environment` ã§å®šç¾©ã—ã¦ã„ã‚‹ `DYNAMODB_TABLE` ã®å€¤ã«ãªã‚Šã¾ã™ã€‚

### resources

`resources` ã«ã¯ AWS ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šäº‹é …ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

ä»Šå›ã¯ DynamoDB ã®ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã‚’è¨˜è¿°ã—ã¦ã„ãã¾ã™ã€‚

```yaml:serverless.yml
resources:
  Resources:
    TodosDynamoDbTable:
      Type: 'AWS::DynamoDB::Table'
#     DeletionPolicy: Retain
      Properties:
        AttributeDefinitions:
          -
            AttributeName: id
            AttributeType: S
        KeySchema:
          -
            AttributeName: id
            KeyType: HASH
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
        TableName: ${self:provider.environment.DYNAMODB_TABLE}
```

- `TodosDynamoDbTable`
  - ã“ã“ã¯ãƒªã‚½ãƒ¼ã‚¹ã®è«–ç† ID ã§ã™ã€‚ä¸€æ„ã§ã‚ã‚Œã°ä»»æ„ã®å€¤ã§å¤§ä¸ˆå¤«ã§ã™ã€‚
- `DeletionPolicy: Retain`
  - ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤ãƒãƒªã‚·ãƒ¼ã®è¨­å®šãŒã§ãã¾ã™ã€‚`Delete`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰, `Retain`, `Snapshot` ã®ã„ãšã‚Œã‹ 3 ã¤ã®è¨­å®šãŒå¯èƒ½ã§ã™ã€‚ã‚¹ã‚¿ãƒƒã‚¯ãŒå‰Šé™¤ã•ã‚Œã¦ã‚‚ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä¿æŒã™ã‚‹å ´åˆã¯ `Retain` ã‚’æ¡ç”¨ã—ã¾ã™ãŒã€ä»Šå›ã¯ã‚¹ã‚¿ãƒƒã‚¯ãŒå‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆ`sls remove -v`ï¼‰ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚å‰Šé™¤ã—ã¦ã»ã—ã„ã®ã§ã€ä½•ã‚‚è¨˜è¿°ã›ãšã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® `Delete` è¨­å®šã¨ã—ã¾ã™ã€‚ï¼ˆ[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-attribute-deletionpolicy.html)ï¼‰
- `AttributeDefinitions`, `KeySchema`, `ProvisionedThroughput`
  - ã“ã®ã‚ãŸã‚Šã®è¨­å®šã¯ DynamoDB ãã®ã‚‚ã®ã«é–¢ã‚ã‚‹è¨­å®šã®ãŸã‚ä»Šå›ã¯èª¬æ˜ã‚’çœç•¥ã„ãŸã—ã¾ã™ã€‚ã“ã“ã§ã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¯ `id` ã¨ã„ã†é …ç›®ã‚’è¨­ã‘ã¾ã—ãŸã‚ˆã€ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆï¼ˆ1 ç§’ã‚ãŸã‚Šã®èª­ã¿è¾¼ã¿/æ›¸ãè¾¼ã¿æ•°ï¼‰ã¯ 1 ã«ã—ã¾ã™ã‚ˆã€ã¨ã„ã†ã“ã¨ãã‚‰ã„ã§ååˆ†ã§ã™ã€‚ï¼ˆAWS DynamoDB ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã®è¨­å®šãŒæ–™é‡‘ã«è·³ã­ã‚‹ã®ã§æ³¨æ„ï¼‰
- `TableName`
  - ãƒ†ãƒ¼ãƒ–ãƒ«åã§ã™ã€‚ä»Šå›ã¯ provider ã® environment ã§ `DYNAMODB_TABLE` ã¯ `${self:service}-${opt:stage, self:provider.stage}` = hogehoge-dev ã¨è¨­å®šã—ã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚è©³ã—ãã¯ provider ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## ãƒ‡ãƒ—ãƒ­ã‚¤

serverless.yml ã‚’æ›´æ–°ã—ãŸã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

```
$ sls deploy -v
ï¼ˆçœç•¥ï¼‰
```

## AWS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ç¢ºèª

ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã¯ãšãªã®ã§ AWS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ DynamoDB ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ã„ã¦ã¿ã¾ã™ã€‚
![Dynamo.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/04bd0cc1-f274-c72c-fa77-f6239267fd61.png)
hogehoge-dev ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ã¾ãŸã€provider.iamRoleStatements ã§ IAM ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¦ã„ã‚‹ã®ã§ã€CWL ã‚‚ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚
![IAM.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/a9753658-b72f-0235-6c5d-386792290b7e.png)
hogehoge-dev ãƒ†ãƒ¼ãƒ–ãƒ«ã«èª­ã¿è¾¼ã¿/æ›¸ãè¾¼ã¿æ¨©é™ãŒã¤ã„ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ã“ã‚Œã§ DynamoDB ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

# 3. API ã®å…¬é–‹ã¨ DynamoDB ã¨ã®ç–é€š

ã“ã¡ã‚‰ã®ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚

![png.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/475e27f7-1b52-eaf8-a86d-0cefce1506bd.png)

## ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆ

ä»¥ä¸‹ã® API ã‚’ä½œæˆã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

| ã‚„ã‚ŠãŸã„ã“ã¨ | path        | method | data(request body parameter) | DynamoDB ã®æ“ä½œ | ç”¨æ„ã™ã‚‹é–¢æ•°å | 
| ------------ | ----------- | ------ | ---------- | -------------- | -------------- | 
| å…¨ä»¶å–å¾—     | /todos      | GET    | ãªã—       | Scan           | list           | 
| å˜ä¸€å–å¾—     | /todos/{id} | GET    | ãªã—       | GetItem        | get            | 
| è¿½åŠ          | /todos      | POST   | ã‚ã‚Š       | PutItem        | create         | 
| æ›´æ–°         | /todos/{id} | PUT    | ã‚ã‚Š       | UpdateItem     | update         | 
| å‰Šé™¤         | /todos/{id} | DELETE | ãªã—       | DeleteItem     | delete         | 

## serverless.yml ã®å¤‰æ›´

è¨­è¨ˆã—ãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ serverless.yml ã«åæ˜ ã•ã›ã¾ã™ã€‚

`path` ã¨ `method` ã‚’ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹ã§ã‚ã‚ã† JavaScript ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãã“ã«å®šç¾©ã™ã‚‹é–¢æ•°ï¼ˆ`handler`ï¼‰ã«çµã³ã¤ã‘ã‚‹ã‚ˆã†ã«æ›¸ãã ã‘ã§ã™ã€‚

```diff:serverless.yml
functions:
       - http:
           path: hello
           method: get
+
+  list:
+    handler: todos/list.list
+    events:
+      - http:
+          path: todos
+          method: get
+          cors: true
+
+  get:
+    handler: todos/get.get
+    events:
+      - http:
+          path: todos/{id}
+          method: get
+          cors: true
+
+  create:
+    handler: todos/create.create
+    events:
+      - http:
+          path: todos
+          method: post
+          cors: true
+
+  update:
+    handler: todos/update.update
+    events:
+      - http:
+          path: todos/{id}
+          method: put
+          cors: true
+
+  delete:
+    handler: todos/delete.delete
+    events:
+      - http:
+          path: todos/{id}
+          method: delete
+          cors: true
```

## å¿…è¦ãª npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®ã‚¢ã‚¤ãƒ†ãƒ ã®è¿½åŠ ã®å‡¦ç†æ™‚ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãª id ã‚’æ‰•ã„å‡ºã™ã®ã« npm ã® `uuid` ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã®ã§ packeage.json ã‚’ä½œæˆã—ã¦ç™»éŒ²ã—ã¾ã™ã€‚

```
$ npm init -y
$ npm install uuid
```

```json:package.json
{
  ï¼ˆçœç•¥ï¼‰
  "dependencies": {
    "uuid": "^8.3.1"
  }
}
```

## å†…éƒ¨å‡¦ç†ã®å®Ÿè£…

è©³ã—ã„å®Ÿè£…ã¯ [GitHub](https://github.com/suguruTakahashi-1234/sls-hogehoge) ã«å…¬é–‹ã—ãŸã®ã§ãã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
å…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã®[ã€ŒAWS | REST API With DynamoDBã€](https://www.serverless.com/examples/aws-node-rest-api-with-dynamodb) ã¨å…¨ãåŒã˜ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã—ãŸã€‚

## ãƒ‡ãƒ—ãƒ­ã‚¤

ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã™ã€‚

```
$ sls deploy -v     
ï¼ˆçœç•¥ï¼‰
Serverless: Stack update finished...
Service Information
service: hogehoge
stage: dev
region: us-east-1
stack: hogehoge-dev
resources: 41
api keys:
  None
endpoints:
  GET - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/hello
  GET - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/todos
  GET - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/todos/{id}
  POST - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/todos
  PUT - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/todos/{id}
  DELETE - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/todos/{id}
functions:
  hello: hogehoge-dev-hello
  list: hogehoge-dev-list
  get: hogehoge-dev-get
  create: hogehoge-dev-create
  update: hogehoge-dev-update
  delete: hogehoge-dev-delete
layers:
  None

ï¼ˆçœç•¥ï¼‰
```

ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆã©ãŠã‚Šã« API ãŒå…¬é–‹ã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

```
endpoints:
  GET - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/hello
  GET - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/todos
  GET - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/todos/{id}
  POST - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/todos
  PUT - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/todos/{id}
  DELETE - https://xxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/todos/{id}
```

## API ã®ç–é€šç¢ºèª

curl ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦ API ã‚’å‘¼ã³å‡ºã—ã¦ã‚‚ã„ã„ã®ã§ã™ãŒã€Postman ã®æ–¹ãŒã„ã‚ã„ã‚ã‚ã‹ã‚Šã‚„ã™ã„ã®ã§ã€Postman ã‹ã‚‰ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

ã‚¢ã‚¤ãƒ†ãƒ ã‚’ POST ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã‚“ã§è¿½åŠ ã—ã¦ã¿ã¾ã™ã€‚
![2 2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/49ff741e-16df-e6eb-2162-507141d667ab.png)
ã†ã¾ãè¡Œã£ã¦ã„ã‚‹ã¿ãŸã„ã§ã™ã­ã€‚

ä»Šåº¦ã¯ GET ã§ Scan ã—ã¦ã¿ã¾ã™ã€‚
![9 2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/383052d6-d4eb-3827-c105-e36986aea70f.png)
ã¡ã‚ƒã‚“ã¨å–å¾—ã§ãã¾ã—ãŸã€‚

## AWS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ç¢ºèª

ã“ã®çµæœã‚’ AWS ã® DynamoDB ã‹ã‚‰ã‚‚ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚
![10 2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/5c2781bf-db04-c09e-3c69-b635ed29066d.png)
ã¡ã‚ƒã‚“ã¨åæ˜ ã•ã‚Œã¦ã„ã‚‹ã¿ãŸã„ã§ã™ã­ã€‚

ã“ã‚Œã§ã‚„ã‚ŠãŸã„ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤

ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ã¾ã§ãŒ Serverless Framework ã§ã™ã€‚

```
$ sls remove -v
ï¼ˆçœç•¥ï¼‰
```

ä¸€å¿œã€å¿µã®ãŸã‚ AWS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’è¦‹ã«è¡Œã£ã¦å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã¯ç¢ºèªã—ãŸæ–¹ãŒã„ã„ã§ã™ã€‚

ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦ã‚‚ã™ãã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã®ã§ã€æœ¬å½“ã«æ°—è»½ã«å‰Šé™¤ã§ãã¾ã™ã­ã€‚

# ã¾ã¨ã‚

Serverless Framework ã‚’ä½¿ã£ã¦ã€ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

- API ã®å…¬é–‹
- ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
- IAM ãƒ­ãƒ¼ãƒ«ã®è¨­å®š
- DynamoDB ã®ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã®è¨­å®š
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®šç¾©ã®è¨­å®š
- API ã¨ DynamoDB ã®ç–é€š

ãã®çµæœã€ä»¥ä¸‹ã®å›³ã®ã‚ˆã†ãªç’°å¢ƒã‚’ Serverless Framework ã§æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

![png.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/5dac1a97-7fa3-233e-d5da-1b4e380fc6be.png)

ã€ç¶šç·¨ã¯ã“ã¡ã‚‰ã€‘
ãƒ»[ã€Serverless Frameworkã€‘ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šæ–¹æ³•ï¼ˆé–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã®åˆ†é›¢ã‚‚è€ƒæ…®ï¼‰](https://qiita.com/sugurutakahashi12345/items/c4e0cf5708a792703b9d)
