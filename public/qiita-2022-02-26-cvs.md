---
title: "[Swift] [Combine] @Published ãªå¤‰æ•°ã¨ã—ã¦ Struct å‹ã‹ã¤ nil ã‚’è¨±å®¹ã—ãŸã¨ãã®æ³¨æ„ç‚¹"
tags:
  - "Swift"
private: false
updated_at: ''
id: aa40ab776acb55d27dff
organization_url_name: null
slide: false
ignorePublish: false
---

# `@Published` / `CurrentValueSubject` ã« `Struct` å‹ã‹ã¤ `nil` ã‚’è¨±å®¹ã—ãŸã¨ãã®æ³¨æ„ç‚¹

`@Published` ãªå¤‰æ•°ã€ã¾ãŸã¯ã€ `CurrentValueSubject` ã® `Output` ã«ã€`Struct` å‹ã‹ã¤ `nil` ã‚’è¨±å®¹ã™ã‚‹ã¨ã€**ãã® `.value` ãŒ `nil` ã®å ´åˆã§ã‚‚ã€ãã®å‹ãŒæŒã£ã¦ã„ã‚‹å¤‰æ•°ã«å€¤ã‚’ä»£å…¥ã™ã‚‹ã¨ã€ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒæµã‚Œã¾ã™ã€‚**

ã¡ãªã¿ã«ã€`Class` å ´åˆã¯ãã®ã‚ˆã†ãªæŒ™å‹•ã¯èµ·ã“ã‚Šã¾ã›ã‚“ã€‚

- å‚è€ƒï¼š[[Swift] [Combine] @Published ãªå¤‰æ•°ãŒ Class ã¨ Struct ã§ã¯æŒ™å‹•ãŒç•°ãªã‚‹ä»¶](https://zenn.dev/ikuraikura/articles/2022-02-26-pub4)

ã“ã®ã‚ˆã†ãªæŒ™å‹•ã®å·®ã¯ã€`Class` ãŒå‚ç…§å‹ã§ã‚ã‚Šã€`Struct` ãŒå€¤å‹ã§ã‚ã‚‹ã“ã¨åŸå› ã§ã‚ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

- å‚è€ƒ
  - [å€¤å‹ã¨å‚ç…§å‹ - Swiftã®å§‹ã‚æ–¹](https://swift.codelly.dev/guide/%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%A8%E3%82%AF%E3%83%A9%E3%82%B9/%E5%80%A4%E5%9E%8B%E3%81%A8%E5%8F%82%E7%85%A7%E5%9E%8B.html)

çŸ¥ã‚‰ãªã„ã¨ãƒãƒã‚Šãã†ã§ã™ã­ã€‚ã€‚ã€‚ï¼ˆãƒãƒã£ãŸã®ã§è¨˜äº‹ã«ã—ã¾ã—ãŸğŸ˜­ï¼‰

# ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

ä»¥ä¸‹ã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

`Struct` ã¨ `Class` ã®æ¯”è¼ƒã®ãŸã‚ã«ã€é©å½“ãª `Struct` ã¨ `Class` ã‚’ç”¨æ„ã—ã¾ã™ã€‚

ä»¥ä¸‹ã‚’å…±é€šã®ã‚³ãƒ¼ãƒ‰ã¨ã—ã¾ã™ã€‚

```swift
var cancellables = Set<AnyCancellable>()

// ğŸ— Struct
struct Moge {
    var mogemoge: Int = 0
    
    init(mogemoge: Int) {
        self.mogemoge = mogemoge
    }
}

// ğŸ« Class
class Fuga {
    var fugafuga: Int = 0
    
    init(fugafuga: Int) {
        self.fugafuga = fugafuga
    }
}
```

# `@Published` ã®å ´åˆ

```swift
class Hoge {
    // ğŸ— Struct
    @Published var moge: Moge? = .init(mogemoge: 0)

    // ğŸ« Class
    @Published var fuga: Fuga? = .init(fugafuga: 0)
    
    init() {}
}

let hoge: Hoge = .init()
```

## ğŸ— Struct ã®å ´åˆ

```swift
// ğŸ— Struct
hoge.$moge
    .dropFirst()
    .sink { print("mogemoge: \(String(describing: $0?.mogemoge))") }
    .store(in: &cancellables)

hoge.moge = Moge(mogemoge: 1)
hoge.moge?.mogemoge = 2
hoge.moge = nil
hoge.moge?.mogemoge = 3
hoge.moge?.mogemoge = 4

// ï¼ˆå‡ºåŠ›ï¼‰
// mogemoge: Optional(1)
// mogemoge: Optional(2)
// mogemoge: nil
// mogemoge: nil â† ãˆâ—ï¸â“
// mogemoge: nil â† ãˆâ—ï¸â“
```

## ğŸ« Class ã®å ´åˆ

```swift
// ğŸ« Class
hoge.$fuga
    .dropFirst()
    .sink { print("mogemoge: \(String(describing: $0?.fugafuga))") }
    .store(in: &cancellables)

hoge.fuga = Fuga(fugafuga: 5)
hoge.fuga?.fugafuga = 6
hoge.fuga = nil
hoge.fuga?.fugafuga = 7
hoge.fuga?.fugafuga = 8

// ï¼ˆå‡ºåŠ›ï¼‰
// fugafuga: Optional(5)
// fugafuga: nil
```


# `CurrentValueSubject` ã®å ´åˆ

`CurrentValueSubject` ã‚‚ `@Puhlished` ã®ã¨ãã¨åŒæ§˜ã®æŒ™å‹•ã«ãªã‚Šã¾ã™ã€‚

```swift
class Hoge {
    // ğŸ— Struct
    var mogePub: CurrentValueSubject<Moge?, Never> = .init(.init(mogemoge: 0))

    // ğŸ« Class
    var fugaPub: CurrentValueSubject<Fuga?, Never> = .init(.init(fugafuga: 0))
    
    init() {}
}

let hoge: Hoge = .init()
```

## ğŸ— Struct ã®å ´åˆ

```swift
// ğŸ— Struct
hoge.mogePub
    .dropFirst()
    .sink { print("mogemoge: \(String(describing: $0?.mogemoge))") }
    .store(in: &cancellables)

hoge.mogePub.value = Moge(mogemoge: 1)
hoge.mogePub.value?.mogemoge = 2
hoge.mogePub.value = nil
hoge.mogePub.value?.mogemoge = 3
hoge.mogePub.value?.mogemoge = 4

// ï¼ˆå‡ºåŠ›ï¼‰
// mogemoge: Optional(1)
// mogemoge: Optional(2)
// mogemoge: nil
// mogemoge: nil â† ãˆâ—ï¸â“
// mogemoge: nil â† ãˆâ—ï¸â“
```

## ğŸ« Class ã®å ´åˆ

```swift
// ğŸ« Class
hoge.fugaPub
    .dropFirst()
    .sink { print("fugafuga: \(String(describing: $0?.))") }
    .store(in: &cancellables)

hoge.fugaPub.value = Fuga(fugafuga: 5)
hoge.fugaPub.value?.fugafuga = 6
hoge.fugaPub.value = nil
hoge.fugaPub.value?.fugafuga = 7
hoge.fugaPub.value?.fugafuga = 8

// ï¼ˆå‡ºåŠ›ï¼‰
// fugafuga: Optional(5)
// fugafuga: nil
```



ä»¥ä¸Šã«ãªã‚Šã¾ã™ã€‚
