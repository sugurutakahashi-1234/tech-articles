---
title: "[Swift] [Combine] ObservableObject ã§ã¯ãªã„ @Published ã®ä½¿ã„æ‰€"
tags:
  - "Swift"
private: false
updated_at: ''
id: 1a192aed657f977e6bad
organization_url_name: null
slide: false
ignorePublish: false
---

# ä¼ãˆãŸã„ã“ã¨

- `ObservableObject` ã‚’é©å¿œã—ãŸ class ã§ãªãã¦ã‚‚ `@Published` ã¯ä½¿ç”¨ã§ãã‚‹ï¼ˆ[å‰ç·¨](https://zenn.dev/ikuraikura/articles/2022-02-23-pub)ã®å†…å®¹ï¼‰
- **ã€å€¤ã‚’æŒã¤ã“ã¨ãŒã§ãã‚‹ã€ã‹ã¤ã€subscribeã§ãã‚‹ã€ã¨ã„ã†å…±é€šç‚¹ãŒ `CurrentValueSubject` ã¨ `@Published` ã«ã¯ã‚ã‚Šã€å¤§æŠµã®å ´åˆã§æ›¸ãæ›ãˆãŒå¯èƒ½ã§ã‚ã‚‹**
  - ç‰¹ã« `@Published` ã®å ´åˆã€`private(set)` ãª Publisher ã‚’è¨˜è¿°ã™ã‚‹ã¨ãã«ç°¡å˜ã«æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ˆä»¥ä¸‹ã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰å‚ç…§ï¼‰

ä¾‹ãˆã°ã€ï¼‰

`CurrentValueSubject` ã§æ›¸ã„ã¦ã„ãŸã“ã‚Œã‚„ã€

```swift
class Hoge {
    private let mogemoge: CurrentValueSubject<Int, Never> = .init(0)
    
    var mogemogePub: AnyPublisher<Int, Never> {
        mogemoge.eraseToAnyPublisher()
    }
}
```

`CurrentValueSubject` ã§æ›¸ã„ã¦ã„ãŸã“ã‚ŒãŒã€

```swift
class Hoge {
    private let mogemoge: CurrentValueSubject<Int, Never> = .init(0)
    
    let mogemogePub: AnyPublisher<Int, Never>
    
    init() {
        mogemogePub = mogemoge.eraseToAnyPublisher()
    }
}
```

`@Published` ã‚’ä½¿ã†ã¨ã€ã“ã†æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```swift
class Hoge {
    @Published private(set) var mogemoge: Int = 0
}
```

# ã¯ã˜ã‚ã«

[å‰ç·¨](https://zenn.dev/ikuraikura/articles/2022-02-23-pub)ã§`ObservableObject` ã§ãªãã¦ã‚‚ `@Published` ãŒä½¿ãˆã‚‹ã“ã¨ã¯åˆ†ã‹ã£ãŸã®ã§ã™ãŒã€ãã®ä½¿ã„é“ã‚’æ¤œè¨ã—ã¾ã™ã€‚

# `@Published` ã¨ `CurrentValueSubject` ã¯ä¼¼ã¦ã„ã‚‹ä»¶

ã¾ãšã¯ã€å‰æã¨ã—ã¦æŠ¼ã•ãˆã¦ã»ã—ã„ã“ã¨ã¨ã—ã¦ã€`@Published` ã¨ `CurrentValueSubject` ã¯ã‹ãªã‚Šä¼¼ã¦ã„ã¾ã™ã€‚

## `CurrentValueSubject` ã®ä¾‹

ä»¥ä¸‹ã‚’æº€ãŸã™ã‚ˆã†ãªé©å½“ãª `Hoge` ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã¾ã™ã€‚

- subscribe å¯èƒ½ãª `mogemoge`
- `mogemoge` ã®å€¤ã‚’æ›´æ–°ã™ã‚‹ Setter ã§ã‚ã‚‹ `setMogemoge()`
- æœ€æ–°ã® `mogemoge` ã®å€¤ã‚’ä½¿ç”¨ã™ã‚‹ç”¨é€”ãŒã‚ã‚‹ã¨ä»®å®šã—ãŸ `printMogemoge()`

```swift
class Hoge {
    let mogemoge: CurrentValueSubject<Int, Never> = .init(0)
    
    func setMogemoge(_ mogemoge: Int) {
        self.mogemoge.value = mogemoge
    }
    
    func printMogemoge() {
        print("mogemoge: \(mogemoge.value)")
    }
}
```

ã“ã®å ´åˆã€Setter ã‹ã‚‰ã‚‚ `CurrentValueSubject` ã® `.value` ã®ä¸¡æ–¹ã§ã€`mogemoge` ã®å€¤ã®æ›´æ–°ãŒå¯èƒ½ã«ãªã£ã¦ã„ã¾ã™ã€‚

```swift
let hoge = Hoge()

// subscribe ã‚’å®Ÿæ–½
hoge.mogemoge
    .sink { print("receive: \($0)") }
    .store(in: &cancellables)

// Setter ã‹ã‚‰å€¤ã®æ›´æ–°ãŒå¯èƒ½
hoge.setMogemoge(1)

// CurrentValueSubject ã®ãŸã‚ mogemoge.value = xxx ã§ã‚‚å€¤ã®æ›´æ–°ãŒå¯èƒ½
hoge.mogemoge.value = 2

// ç¾åœ¨ã® Hoge().mogemoge ã®å€¤ã‚’å‡ºåŠ›ã™ã‚‹
hoge.printMogemoge()

// ï¼ˆå‡ºåŠ›ï¼‰
// receive: 0
// receive: 1
// receive: 2
// mogemoge: 2
```

## `@Published` ã®å ´åˆ

ã“ã“ã§å…ˆã»ã© `CurrentValueSubject` ã§è¨˜è¿°ã—ã¦ã„ãŸ `mogemoge` ã‚’ `@Published var` ã§æ›¸ãç›´ã™ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```swift
class Hoge {
    // `@Published var` ã«å¤‰æ›´ğŸŒŸ
    @Published var mogemoge: Int = 0
    
    func setMogemoge(_ mogemoge: Int) {
        self.mogemoge = mogemoge
    }
    
    func printMogemoge() {
        print("mogemoge: \(mogemoge)")
    }
}
```

```swift
let hoge = Hoge()

// `$` ã§ Publisher ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ğŸŒŸ
hoge.$mogemoge
    .sink { print("receive: \($0)") }
    .store(in: &cancellables)

hoge.setMogemoge(1)

// @Published var mogemoge ã¯å¤–ã‹ã‚‰ä»£å…¥å¯èƒ½ğŸŒŸ
hoge.mogemoge = 2

hoge.printMogemoge()

// ï¼ˆå‡ºåŠ›ï¼‰
// receive: 0
// receive: 1
// receive: 2
// mogemoge: 2
```

**ã“ã®ã‚ˆã†ã«ã€å€¤ã‚’æŒã¤ã“ã¨ãŒã§ãã‚‹ã€ã‹ã¤ã€subscribeã§ãã‚‹ã€ã¨ã„ã†å…±é€šç‚¹ãŒ `CurrentValueSubject` ã¨ `@Published` ã«ã¯ã‚ã‚Šã€æ›¸ãæ›ãˆãŒå¯èƒ½ã§ã™ã€‚**

# subscribe å¯èƒ½ãªå€¤ã‚’å¤–éƒ¨ã‹ã‚‰ç·¨é›†ã•ã‚Œãªã„æ–¹æ³•ã‚’æ¤œè¨ã™ã‚‹

ä¸Šè¨˜ã§èª¬æ˜ã—ãŸã‚ˆã†ã« `@Published` ã¨ `CurrentValueSubject` ã¯ä¼¼ã¦ã„ã‚‹ã®ã§ã™ãŒã€`private` ã®ã‚¢ã‚¯ã‚»ã‚¹ä¿®é£¾å­ã‚’ã¤ã‘ã¦ã¿ã‚‹ã¨æŒ™å‹•ã®å·®ãŒã§ã¦ãã¾ã™ã€‚

ä¾‹ãˆã°å…ˆã»ã©ã® `Hoge` ã‚¯ãƒ©ã‚¹ã«ã¤ã„ã¦ã€ã€`mogemoge` ã¯å¤–éƒ¨ã‹ã‚‰ã¯å€¤ã‚’ç›´æ¥ç·¨é›†ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ã€ã¨ã„ã†æ¡ä»¶ã‚’åŠ ãˆã¾ã™ã€‚

- subscribe å¯èƒ½ãª `mogemoge`
- `mogemoge` ã®å€¤ã‚’æ›´æ–°ã™ã‚‹ Setter ã§ã‚ã‚‹ `setMogemoge()`
- æœ€æ–°ã® `mogemoge` ã®å€¤ã‚’ä½¿ç”¨ã™ã‚‹ç”¨é€”ãŒã‚ã‚‹ã¨ä»®å®šã—ãŸ `printMogemoge()`
- **`mogemoge` ã¯å¤–éƒ¨ã‹ã‚‰å€¤ã‚’ç›´æ¥ç·¨é›†ã§ããªã„ã‚ˆã†ã«ã™ã‚‹** â† **New** 

**ã¤ã¾ã‚Šã€`mogemoge` ã¯ `setMogemoge()` ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã®ã¿å€¤ã®å¤‰æ›´ã‚’ã•ã›ãŸã„ã¨ã—ã¾ã™ã€‚**

ãã®ã¨ãã«ã€`@Published` ã¨ `CurrentValueSubject` ã§å®Ÿè£…ã—ã‚ˆã†ã¨ã™ã‚‹ã¨å·®ãŒå‡ºã¦ãã¾ã™ã€‚

## æ–¹æ³•1: âŒ `CurrentValueSubject` ã®å¤‰æ•°ã« `private` ã‚’ã¤ã‘ãŸå ´åˆ

ã¾ãšã€`CurrentValueSubject` ã®å¤‰æ•°ã« `private` ã‚’ã¤ã‘ã¦ã¿ã¾ã™ã€‚

```swift
class Hoge {
    // private ã®ã‚¢ã‚¯ã‚»ã‚¹ä¿®é£¾å­ã‚’ã¤ã‘ã‚‹
    private let mogemoge: CurrentValueSubject<Int, Never> = .init(0)
    
    func setMogemoge(_ mogemoge: Int) {
        self.mogemoge.value = mogemoge
    }
    
    func printMogemoge() {
        print("mogemoge: \(mogemoge.value)")
    }
}
```

ç¢ºã‹ã«ä»¥ä¸‹ã®ã‚ˆã†ã« `hoge.mogemoge.value = xxx` ã§ã®å¤‰æ›´ã¯ã§ããªããªã‚Šã¾ã™ã€‚

ã—ã‹ã—ã€æ®‹å¿µãªãŒã‚‰ subscribe ã‚‚ã§ããªããªã‚Šã¾ã—ãŸğŸ˜­

```swift
let hoge = Hoge()

// subscribe ã§ããªããªã£ãŸğŸ˜­ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼‰
hoge.mogemoge // 'mogemoge' is inaccessible due to 'private' protection level
    .sink { print("receive: \($0)") }
    .store(in: &cancellables)

hoge.setMogemoge(1)

// hoge.mogemoge.value = xxx ã§å¤‰æ›´ã§ããªããªã£ãŸ â† ç‹™ã„é€šã‚ŠğŸ˜
hoge.mogemoge.value = 2 // 'mogemoge' is inaccessible due to 'private' protection level

hoge.printMogemoge()
```

å½“ãŸã‚Šå‰ã®æŒ™å‹•ã§ã™ã­ã€‚

æ¬¡ã®æ‰‹ã¨ã—ã¦ã€`private(set)` ã‚’æ¤œè¨ã—ã¾ã™ã€‚

## æ–¹æ³•2: âŒ `CurrentValueSubject` ã®å¤‰æ•°ã« `private(set)` ã‚’ã¤ã‘ãŸå ´åˆ

`mogemoge` ã« `private(set)` ã®ã‚¢ã‚¯ã‚»ã‚¹ä¿®é£¾å­ã‚’ã¤ã‘ã¾ã™ã€‚

ã¾ãŸã€ `private(set) let` ã¨ã¯ã§ããªã„ãŸã‚ã€`let` ã‚’ `var` ã«å¤‰æ›´ã—ã¾ã™ã€‚

ã“ã‚Œã§ãªã‚‰ã€subscribe ã‚’è¨±å¯ã—ãŸã¾ã¾ã€å€¤ã®ç›´æ¥ç·¨é›†ã‚’åˆ¶é™ã§ããã†ã§ã™ã€‚

```swift
class Hoge {
    // CurrentValueSubject ã‚’ private(set) ãªå¤‰æ•°ã¨ã™ã‚‹
    private(set) var mogemoge: CurrentValueSubject<Int, Never> = .init(0)
    
    func setMogemoge(_ mogemoge: Int) {
        self.mogemoge.value = mogemoge
    }
    
    func printMogemoge() {
        print("mogemoge: \(mogemoge.value)")
    }
}
```

æ®‹å¿µãªãŒã‚‰ã€ãã†ã¯ãªã‚Šã¾ã›ã‚“ã§ã—ãŸğŸ˜­

ä»¥ä¸‹ã‚’ã”è¦§ãã ã•ã„ã€‚

```swift
let hoge = Hoge()

// subscribe ã§ãã‚‹ğŸŒŸ
hoge.mogemoge
    .sink { print("receive: \($0)") }
    .store(in: &cancellables)

hoge.setMogemoge(1)

// private(set) ã§ã‚‚ `hoge.mogemoge.value = xxx` ã—ã¦ã‚‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã«ãªã‚‰ãªã„ğŸ˜­
hoge.mogemoge.value = 2

hoge.printMogemoge()

// ï¼ˆå‡ºåŠ›ï¼‰
// receive: 0
// receive: 1
// mogemoge: 1
// mogemoge: 2
```

`hoge.mogemoge.value = xxx` ã§æ›´æ–°ã§ãã¦ã—ã¾ã„ã¾ã—ãŸğŸ˜­


### â†‘ã“ã†ãªã‚‹è§£èª¬ï¼ˆ`private(set) var` ã®æŒ™å‹•ã«ã¤ã„ã¦ï¼‰

å®Ÿã¯ã“ã‚Œã¯å½“ãŸã‚Šå‰ã®ã“ã¨ã§ã€ä»¥ä¸‹ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã«ã€ã‚¯ãƒ©ã‚¹ã®æ›´æ–°ãŒã§ããªã„ã ã‘ã§ã€ãã®ã‚¯ãƒ©ã‚¹ã®ã‚‚ã¤å¤‰æ•°ã¯æ›´æ–°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```swift
class Moge {
    var piyopiyo: Int = 0
}

class Hoge {
    private(set) var moge: Moge = .init()
}

let hoge = Hoge()

// ã“ã‚Œã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
hoge.moge = Moge() // Cannot assign to property: 'moge' setter is inaccessible

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã¨ã¯ãªã‚‰ãªã„
hoge.moge.piyopiyo = 1
```

`CurrentValueSubject` ã®[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developer.apple.com/documentation/combine/currentvaluesubject)ã‚’ã¿ã‚‹ã¨ã‚ã‹ã‚‹ã®ã§ã™ãŒã€`CurrentValueSubject` å®Ÿã¯ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

```swift
final class CurrentValueSubject<Output, Failure> where Failure : Error
```

ãªã®ã§ã€ä¸Šè¨˜ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¨åŒã˜ã‚ˆã†ã« `private(set)` ã§ã‚‚å€¤ã‚’æ›´æ–°ã§ãã¦ã—ã¾ã†ã®ã§ã™ã€‚

## æ–¹æ³•3: â­•ï¸ åˆ¥å£ã® `AnyPublisher` ã‚’å…¬é–‹ã™ã‚‹(ãã®1)

å…ˆã»ã©ã® `CurrentValueSubject` ã® `mogemoge` ã« `private` ã®ã‚¢ã‚¯ã‚»ã‚¹ä¿®é£¾å­ã‚’ã¤ã‘ã‚‹ã“ã¨ã«åŠ ãˆã¦ã€`mogemoge` ã¨ã¯åˆ¥å£ã§ `AnyPublisher` ã§ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã—ãŸ `mogemogePub` ã¨ã—ã¦å…¬é–‹ã•ã›ã¾ã™ã€‚

æ–¹æ³•ã¯ä»¥ä¸‹ã® 2 ç¨®é¡ã‚ã‚‹ã®ã§ã™ãŒã€ä»Šå›ã¯ã€**`init()` ã§è¨­å®šã™ã‚‹**ã€ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

- **ãã®1ï¼š`init()` ã§è¨­å®šã™ã‚‹  â† ã“ã£ã¡**
- ãã®2ï¼šComputed property ã§è¨­å®šã™ã‚‹

```swift
class Hoge {
    private let mogemoge: CurrentValueSubject<Int, Never> = .init(0)
    
    // subscribe å°‚ç”¨ã® mogemogePub ã‚’ç”¨æ„
    let mogemogePub: AnyPublisher<Int, Never>
    
    init() {
        // init() ã§è¨­å®š
        mogemogePub = mogemoge.eraseToAnyPublisher()
    }
    
    func setMogemoge(_ mogemoge: Int) {
        self.mogemoge.value = mogemoge
    }
    
    func printMogemoge() {
        print("mogemoge: \(mogemoge.value)")
    }
}
```

`mogemoge` ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã—ãŸã¾ã¾ã€`mogemogePub` ã‚’ subscribe ã•ã›ã¾ã™ã€‚

```swift
let hoge = Hoge()

// mogemogePub ãªã‚‰ subscribe ã§ãã‚‹ğŸŒŸ
hoge.mogemogePub
    .sink { print("receive: \($0)") }
    .store(in: &cancellables)

hoge.setMogemoge(1)

// ä»¥ä¸‹ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ããšã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ â† ç‹™ã„é€šã‚ŠğŸ˜
// hoge.mogemoge.value = 2 // 'mogemoge' is inaccessible due to 'private' protection level

hoge.printMogemoge()

// ï¼ˆå‡ºåŠ›ï¼‰
// receive: 0
// receive: 1
// mogemoge: 1
```

`setMogemoge()` ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã®ã¿å€¤ã®å¤‰æ›´ã«åˆ¶é™ã§ãã¦ã€`CurrentValueSubject` ã® `.value = xxx` ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¦æ­¢ã™ã‚‹ã“ã¨ã«æˆåŠŸã—ã¾ã—ãŸã€‚

## æ–¹æ³•4: â­•ï¸ åˆ¥å£ã® `AnyPublisher` ã‚’å…¬é–‹ã™ã‚‹(ãã®2)

ç¶šã„ã¦ã€**Computed property ã§è¨­å®šã™ã‚‹**ã€ã®æ–¹ã‚‚ç´¹ä»‹ã—ã¾ã™ã€‚

ã¡ãªã¿ã«ç§ã¯ã“ã¡ã‚‰ã®æ–¹ãŒå¥½ã¿ã§ã™ã€‚

- ãã®1ï¼š`init()` ã§è¨­å®šã™ã‚‹
- **ãã®2ï¼šComputed property ã§è¨­å®šã™ã‚‹ â† ã“ã£ã¡**

```swift
class Hoge {
    private let mogemoge: CurrentValueSubject<Int, Never> = .init(0)
    
    // init() ã§è¨­å®šã›ãšã« Computed property ã«ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼ˆãŸã ã— var ã¨ãªã‚‹ï¼‰
    var mogemogePub: AnyPublisher<Int, Never> {
        mogemoge.eraseToAnyPublisher()
    }
    
    func setMogemoge(_ mogemoge: Int) {
        self.mogemoge.value = mogemoge
    }
    
    func printMogemoge() {
        print("mogemoge: \(mogemoge.value)")
    }
}
```

å…ˆã»ã©ã¨åŒæ§˜ã«ã€`mogemoge` ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã—ãŸã¾ã¾ã€`mogemogePub` ã‚’ subscribe ã•ã›ã¾ã™ã€‚

```swift
let hoge = Hoge()

// mogemogePub ãªã‚‰ subscribe ã§ãã‚‹ğŸŒŸ
hoge.mogemogePub
    .sink { print("receive: \($0)") }
    .store(in: &cancellables)

hoge.setMogemoge(1)

// ä»¥ä¸‹ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ããšã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ â† ç‹™ã„é€šã‚ŠğŸ˜
// hoge.mogemoge.value = 2 // 'mogemoge' is inaccessible due to 'private' protection level

hoge.printMogemoge()

// ï¼ˆå‡ºåŠ›ï¼‰
// receive: 0
// receive: 1
// mogemoge: 1
```

æ–¹æ³•4 ã¨åŒæ§˜ã«ã“ã‚Œã§ã‚‚ã„ã‘ã¾ã™ã­ã€‚

## æ–¹æ³•5: âŒ `@Published` ã®å¤‰æ•°ã« `private` ã‚’ã¤ã‘ãŸå ´åˆ

æ–¹æ³•1 ã‚’ `CurrentValueSubject` ã§ã¯ãªã `@Published` ã§æ›¸ã„ãŸå ´åˆã§ã™ã€‚

```swift
class Hoge {
    // @Published private ã‚’ã¤ã‘ã‚‹ğŸŒŸ
    @Published private var mogemoge: Int = 0
    
    func setMogemoge(_ mogemoge: Int) {
        self.mogemoge = mogemoge
    }
    
    func printMogemoge() {
        print("mogemoge: \(mogemoge)")
    }
}
```

ã‚‚ã¡ã‚ã‚“ã€æ–¹æ³•1 ã¨åŒæ§˜ã« subscribe ã§ããªããªã‚Šã¾ã™ğŸ˜­

```swift
let hoge = Hoge()

// subscribe ã§ããªããªã£ãŸğŸ˜­ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼‰
hoge.$mogemoge // '$mogemoge' is inaccessible due to 'private' protection level
    .sink { print("receive: \($0)") }
    .store(in: &cancellables)

hoge.setMogemoge(1)

// mogemoge = xxx ã§å¤‰æ›´ã§ããªããªã£ãŸ â† ç‹™ã„é€šã‚ŠğŸ˜
hoge.mogemoge = 2 // 'mogemoge' is inaccessible due to 'private' protection level

hoge.printMogemoge()
```

## æ–¹æ³•6: â­•ï¸ `@Published` ã®å¤‰æ•°ã« `private(set)` ã‚’ã¤ã‘ãŸå ´åˆ

æ–¹æ³•2 ã‚’ `CurrentValueSubject` ã§ã¯ãªã `@Published` ã§æ›¸ã„ãŸå ´åˆã§ã™ã€‚

```swift
class Hoge {
    // @Published private(set) ã‚’ã¤ã‘ã‚‹ğŸŒŸ
    @Published private(set) var mogemoge: Int = 0
    
    func setMogemoge(_ mogemoge: Int) {
        self.mogemoge = mogemoge
    }
    
    func printMogemoge() {
        print("mogemoge: \(mogemoge)")
    }
}
```

ã©ã†ã›ã€æ–¹æ³•2 ã® `CurrentValueSubject` ã¿ãŸãã†ã¾ãã„ã‹ãªã„ã®ã ã‚ã†ã¨æ€ã£ãŸã®ã§ã™ãŒã€ã“ã‚ŒãŒã†ã¾ãã„ãã¾ã™ã€‚

```swift
let hoge = Hoge()

// @Published private(set) ãªã‚‰ subscribe ã§ãã‚‹ğŸŒŸ
hoge.$mogemoge
    .sink { print("receive: \($0)") }
    .store(in: &cancellables)

hoge.setMogemoge(1)

// ä»¥ä¸‹ã¯ç‹™ã„é€šã‚Šã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ğŸ˜
// hoge.mogemoge = 2 // Cannot assign to property: 'mogemoge' setter is inaccessible

hoge.printMogemoge()

// ï¼ˆå‡ºåŠ›ï¼‰
// receive: 0
// receive: 1
// mogemoge: 1
```

`CurrentValueSubject` ã®å ´åˆã¯ `mogemoge.value` ã®å€¤ã‚’æ›´æ–°ã—ã¦ã„ãŸã®ã§ã€`private(set) var` ã§ã¯åˆ¶é™ã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€`@Published` ã®å ´åˆã¯ã€`mogemoge` ã®å€¤ã‚’ç›´æ¥ç·¨é›†ã—ã«è¡Œã£ã¦ã„ã‚‹ã®ã§ã€ã¡ã‚ƒã‚“ã¨åˆ¶é™ã§ãã‚‹ã‚ˆã†ã§ã™ã€‚

**ã“ã‚Œã§ã‚ã‚Œã°ã€æ–¹æ³•3 ã‚„æ–¹æ³•4 ã®ã‚ˆã†ã«åˆ¥å£ã® `AnyPublisher` ã‚’å…¬é–‹ã™ã‚‹å¿…è¦ã‚‚ãªã„ã®ã§ã€ã‚·ãƒ³ãƒ—ãƒ«ã«å®Ÿè£…ã§ãã¾ã™ã­ã€‚**

**ã“ã®è¾ºã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã¯ `CurrentValueSubject` ã«ã¯ã§ããªã„ `@Published` ã®ä½¿ã„é“ã¨ãªã‚Šã¾ã™ã€‚**

ä»–ã«ã‚‚ã€`CurrentValueSubject` ã®è¨˜è¿°ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹ä¾‹ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚

# `PassthroughSubject` ã‚‚ `@Published` ã§æ›¸ãç›´ã›ã‚‹ã®ã‹ï¼Ÿ

`CurrentValueSubject` ã®æ–¹æ³•4 ã§è¡Œã£ã¦ã„ãŸã“ã¨ã‚’ `PassthroughSubject` ã§æ›¸ãç›´ã—ã¦ã¿ã¾ã™ã€‚

```swift
class Hoge {
    private let mogemoge = PassthroughSubject<Int, Never>()
    
    var mogemogePub: AnyPublisher<Int, Never> {
        mogemoge.eraseToAnyPublisher()
    }
    
    // `setMogemoge()` ã§ã¯ãªã `sendMogemoge()` ãŒé©åˆ‡ã ã¨æ€ã„ã¾ã™ãŒã€‚
    func setMogemoge(_ mogemoge: Int) {
        self.mogemoge.send(mogemoge)
    }
    
    // PassthroughSubject ã§ã¯å€¤ã‚’ä¿æŒã§ããªã„ã®ã§ã“ã‚Œã«ç›¸å½“ã™ã‚‹å‡¦ç†ãŒè¨˜è¿°ã§ããªã„
    // func printMogemoge() {
    //     print("mogemoge: \(mogemoge.value)")
    // }
}

let hoge = Hoge()

hoge.mogemogePub
    .sink { print("receive: \($0)") }
    .store(in: &cancellables)

hoge.setMogemoge(1)

// ï¼ˆå‡ºåŠ›ï¼‰
// receive: 1
```

ã“ã‚Œã‚’æ–¹æ³•6 ã® `@Published` ã®å¤‰æ•°ã« `private(set)` ã§æ›¸ã„ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§æ›¸ãç›´ã›ã‚‹ã‹ã©ã†ã‹ã«ã¤ã„ã¦æ¤œè¨ã—ã¾ã™ã€‚

å€‹äººçš„ã«ã¯ **`PassthroughSubject` ã¯ç¾åœ¨å€¤ã‚’ä¿æœ‰ã—ã¦ã„ãªã„ãŸã‚ã€`CurrentValueSubject` ã‚„ `@Published` ã¨å…¨ãæ€§è³ªã®ç•°ãªã‚‹ã‚‚ã®ã§ã‚ã‚Šã€å˜ã«è¨˜è¿°é‡ãŒæ¸›ã‚‹ã‹ã‚‰ã¨ã„ã£ã¦ã€`@Published` ã«æ›¸ãç›´ã—ãŸã‚Šã¯ã—ãªã„ã»ã†ãŒé©åˆ‡ã ã¨æ€ã„ã¾ã™ã€‚**

# çµè«–

- `ObservableObject` ã‚’é©å¿œã—ãŸ class ã§ãªãã¦ã‚‚ `@Published` ã¯ä½¿ç”¨ã§ãã‚‹ï¼ˆ[å‰ç·¨](https://zenn.dev/ikuraikura/articles/2022-02-23-pub)ã®å†…å®¹ï¼‰
- **ã€å€¤ã‚’æŒã¤ã“ã¨ãŒã§ãã‚‹ã€ã‹ã¤ã€subscribeã§ãã‚‹ã€ã¨ã„ã†å…±é€šç‚¹ãŒ `CurrentValueSubject` ã¨ `@Published` ã«ã¯ã‚ã‚Šã€å¤§æŠµã®å ´åˆã§æ›¸ãæ›ãˆãŒå¯èƒ½ã§ã‚ã‚‹**
  - ç‰¹ã« `@Published` ã®å ´åˆã€`private(set)` ãª Publisher ã‚’è¨˜è¿°ã™ã‚‹ã¨ãã«ç°¡å˜ã«æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ˆä»¥ä¸‹ã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰å‚ç…§ï¼‰

ä¾‹ãˆã°ã€ï¼‰

`CurrentValueSubject` ã§æ›¸ã„ã¦ã„ãŸã“ã‚Œã‚„ã€

```swift
class Hoge {
    private let mogemoge: CurrentValueSubject<Int, Never> = .init(0)
    
    var mogemogePub: AnyPublisher<Int, Never> {
        mogemoge.eraseToAnyPublisher()
    }
}
```

`CurrentValueSubject` ã§æ›¸ã„ã¦ã„ãŸã“ã‚ŒãŒã€

```swift
class Hoge {
    private let mogemoge: CurrentValueSubject<Int, Never> = .init(0)
    
    let mogemogePub: AnyPublisher<Int, Never>
    
    init() {
        mogemogePub = mogemoge.eraseToAnyPublisher()
    }
}
```

`@Published` ã‚’ä½¿ã†ã¨ã€ã“ã†æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```swift
class Hoge {
    @Published private(set) var mogemoge: Int = 0
}
```

ä»¥ä¸Šã«ãªã‚Šã¾ã™ã€‚
